# Nextended.CodeGen

Compile-time source code generation from various sources including classes, JSON, XML, and Excel files.

## Overview

Nextended.CodeGen is a Roslyn source generator that automatically generates code at compile-time. It supports DTO generation from attributes, class generation from JSON/XML structures, and model generation from Excel spreadsheets.

**Note**: This package is in early testing stage. The API may change in future releases.

## Installation

```bash
dotnet add package Nextended.CodeGen
dotnet add package Nextended.Core
```

## Key Features

### 1. DTO Generation from Attributes

Automatically generate Data Transfer Objects (DTOs) from your domain classes.

```csharp
using Nextended.Core.Attributes;

[AutoGenerateDto(
    ToDtoMethodName = "ToDto",
    ToSourceMethodName = "ToEntity",
    IsComCompatible = true,
    Namespace = "MyApp.Dtos"
)]
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Email { get; set; }
    public string Password { get; set; } // Can be excluded in DTO
}
```

Generated DTO:
```csharp
namespace MyApp.Dtos
{
    public class UserDto
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Email { get; set; }
    }
}
```

### 2. Class Generation from JSON/XML

Generate strongly-typed classes from configuration files or API responses.

```json
// appsettings.json
{
  "Database": {
    "ConnectionString": "Server=localhost;...",
    "MaxPoolSize": 100
  },
  "Api": {
    "BaseUrl": "https://api.example.com",
    "Timeout": 30
  }
}
```

Configuration:
```json
{
  "StructureGenerations": [
    {
      "SourceFile": "/Sources/appsettings.json",
      "RootClassName": "ServerConfiguration",
      "Namespace": "MyApp.Configuration"
    }
  ]
}
```

Generated class:
```csharp
namespace MyApp.Configuration
{
    public class ServerConfiguration
    {
        public Database Database { get; set; }
        public Api Api { get; set; }
    }
    
    public class Database
    {
        public string ConnectionString { get; set; }
        public int MaxPoolSize { get; set; }
    }
    
    public class Api
    {
        public string BaseUrl { get; set; }
        public int Timeout { get; set; }
    }
}
```

### 3. Excel to Class Generation

Generate data classes and static lookup tables from Excel spreadsheets.

```json
{
  "ExcelGenerations": [
    {
      "ModelType": "RecordStruct",
      "SourceFile": "/Sources/countries.xlsx",
      "Namespace": "MyApp.Data",
      "RootClassName": "Country",
      "KeyColumn": "A",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "GenerateModelClass": true,
      "GenerateStaticTable": true,
      "StaticClassName": "Countries",
      "GenerateAllCollection": true
    }
  ]
}
```

## Configuration

### Project Setup

1. Add packages to your `.csproj`:

```xml
<ItemGroup>
  <PackageReference Include="Nextended.CodeGen" Version="9.0.15" />
  <PackageReference Include="Nextended.Core" Version="9.0.15" PrivateAssets="all" GeneratePathProperty="true" />
</ItemGroup>
```

2. Create `CodeGen.config.json`:

```json
{
  "DtoGeneration": {
    "ComIdClassName": "ComGuids",
    "ComIdClassPropertyFormat": "Id{0}",
    "ComIdClassModifier": "Public",
    "OneFilePerClass": true,
    "CreateRegions": true,
    "CreateComments": true,
    "GeneratePartial": true,
    "Namespace": "MyApp.Generated",
    "Suffix": "Dto"
  },
  "StructureGenerations": [
    {
      "SourceFile": "/Sources/appsettings.json",
      "RootClassName": "AppSettings",
      "Namespace": "MyApp.Configuration"
    }
  ]
}
```

3. Add config file to `.csproj`:

```xml
<ItemGroup>
  <AdditionalFiles Include="CodeGen.config.json" />
</ItemGroup>
```

## Usage Examples

### Basic DTO Generation

```csharp
using Nextended.Core.Attributes;

[AutoGenerateDto]
public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }
    public DateTime CreatedDate { get; set; }
}

// Usage after build
var product = new Product 
{ 
    Id = 1, 
    Name = "Widget", 
    Price = 99.99m 
};

var dto = product.ToDto(); // Generated extension method
var backToEntity = dto.ToEntity(); // Round-trip conversion
```

### Advanced DTO Configuration

```csharp
[AutoGenerateDto(
    Suffix = "Dto",
    Prefix = null,
    ToDtoMethodName = "ToTransferObject",
    ToSourceMethodName = "ToModel",
    Namespace = "MyApp.Dtos",
    IsComCompatible = true,
    GeneratePartial = true
)]
public class Order
{
    public int Id { get; set; }
    public string OrderNumber { get; set; }
    public List<OrderItem> Items { get; set; }
    public Customer Customer { get; set; }
    
    [IgnoreInDto]
    public string InternalNotes { get; set; }
}
```

### Configuration from JSON

**appsettings.json:**
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning"
    }
  },
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=MyDb;..."
  },
  "Features": {
    "EnableCache": true,
    "MaxRetries": 3
  }
}
```

**CodeGen.config.json:**
```json
{
  "StructureGenerations": [
    {
      "SourceFile": "/Sources/appsettings.json",
      "RootClassName": "AppConfiguration",
      "Namespace": "MyApp.Config",
      "Ignore": ["Logging.LogLevel.Microsoft"]
    }
  ]
}
```

**Usage:**
```csharp
var config = new AppConfiguration();
var connectionString = config.ConnectionStrings.DefaultConnection;
```

### Excel Data Generation

**Excel file structure:**
| Code | Name | Country | Active |
|------|------|---------|--------|
| US   | United States | USA | Yes |
| UK   | United Kingdom | GBR | Yes |
| CA   | Canada | CAN | Yes |

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Sources/locations.xlsx",
      "Namespace": "MyApp.Data",
      "RootClassName": "Location",
      "KeyColumn": "A",
      "StaticClassName": "Locations",
      "GenerateStaticTable": true,
      "ColumnMappings": {
        "Code": "LocationCode",
        "Name": "LocationName"
      }
    }
  ]
}
```

**Generated code:**
```csharp
public record struct Location
{
    public string LocationCode { get; init; }
    public string LocationName { get; init; }
    public string Country { get; init; }
    public string Active { get; init; }
}

public static class Locations
{
    public static Location US => new() 
    { 
        LocationCode = "US", 
        LocationName = "United States",
        Country = "USA",
        Active = "Yes"
    };
    
    public static Location UK => new() 
    { 
        LocationCode = "UK", 
        LocationName = "United Kingdom",
        Country = "GBR",
        Active = "Yes"
    };
    
    public static IReadOnlyList<Location> All { get; } = new[]
    {
        US, UK, CA
    };
}
```

**Usage:**
```csharp
var usLocation = Locations.US;
var allLocations = Locations.All;
```

## AutoGenerateDto Attribute Reference

The `AutoGenerateDto` attribute is applied to classes or enums to generate DTOs at compile-time.

### Basic Usage

```csharp
[AutoGenerateDto]
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
}
// Generates: UserDto class with mapping methods
```

### Attribute Properties

#### Namespace and Naming

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `Namespace` | string | null | Target namespace for generated DTO. If null, uses source class namespace |
| `Prefix` | string | "" | Prefix for generated class name (e.g., "Com" → "ComUserDto") |
| `Suffix` | string | "Dto" | Suffix for generated class name (e.g., "Dto" → "UserDto") |
| `GeneratedClassName` | string | null | Override complete class name. Ignores prefix/suffix if set |

**Example:**
```csharp
[AutoGenerateDto(
    Namespace = "MyApp.Api.Dtos",
    Prefix = "Api",
    Suffix = "Response"
)]
public class User { }
// Generates: MyApp.Api.Dtos.ApiUserResponse
```

#### Mapping Configuration

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `GenerateMapping` | bool | true | Generate extension methods for mapping (ToDto/ToSource) |
| `ToDtoMethodName` | string | null | Name of the method to convert source to DTO (e.g., "ToDto") |
| `ToSourceMethodName` | string | null | Name of the method to convert DTO back to source (e.g., "ToEntity") |

**Example:**
```csharp
[AutoGenerateDto(
    ToDtoMethodName = "ToApiModel",
    ToSourceMethodName = "ToEntity"
)]
public class User { }

// Usage:
var dto = user.ToApiModel();
var entity = dto.ToEntity();
```

#### Property Control

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `PropertiesToIgnore` | string[] | null | Property names to exclude from DTO generation |

**Example:**
```csharp
[AutoGenerateDto(PropertiesToIgnore = new[] { "Password", "InternalId" })]
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Password { get; set; }  // Not included in DTO
    public Guid InternalId { get; set; }  // Not included in DTO
}
```

**Alternative:** Use `[IgnoreOnGeneration]` attribute on properties:
```csharp
public class User
{
    public int Id { get; set; }
    
    [IgnoreOnGeneration]
    public string Password { get; set; }  // Not included in DTO
}
```

#### Inheritance and Interfaces

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `BaseType` | string | null | Base type for generated DTO (e.g., "BaseDto") |
| `Interfaces` | string[] | null | Interfaces to implement (e.g., "IDto", "IValidatable") |
| `AutoGenerateDerived` | bool | false | Automatically generate DTOs for derived classes |

**Example:**
```csharp
[AutoGenerateDto(
    BaseType = "EntityBase",
    Interfaces = new[] { "IDto", "IAuditable" }
)]
public class User { }

// Generates:
public class UserDto : EntityBase, IDto, IAuditable
{
    // Properties...
}
```

#### COM Compatibility

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `IsComCompatible` | bool | false | Generate COM-visible and COM-compatible code with GUIDs |

**Example:**
```csharp
[AutoGenerateDto(IsComCompatible = true)]
public class User { }

// Generates:
[ComVisible(true)]
[Guid("...")]
public class UserDto
{
    // Properties...
}
```

#### Modifiers and Access

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `ClassModifier` | Modifier | Public | Access modifier for generated class (Public, Internal, Private) |
| `InterfaceModifier` | Modifier | Public | Access modifier for generated interface |
| `DefaultPropertyInterfaceAccess` | InterfaceProperty | GetSet | Default property access in interface (Get, Set, GetSet) |

**Example:**
```csharp
[AutoGenerateDto(
    ClassModifier = Modifier.Internal,
    InterfaceModifier = Modifier.Public
)]
public class User { }
```

#### Attributes and Metadata

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `KeepAttributesOnGeneratedClass` | bool | false | Copy attributes from source class to DTO |
| `KeepAttributesOnGeneratedInterface` | bool | false | Copy attributes from source class to generated interface |
| `KeepPropertyAttributesOnGeneratedClass` | bool | false | Copy property attributes to DTO properties |
| `KeepPropertyAttributesOnGeneratedInterface` | bool | false | Copy property attributes to interface properties |
| `PreClassString` | string | null | String to add before class (e.g., attributes) |
| `PreInterfaceString` | string | null | String to add before interface (e.g., attributes) |

**Example:**
```csharp
[AutoGenerateDto(
    PreClassString = "[Serializable]\n[JsonObject]",
    KeepPropertyAttributesOnGeneratedClass = true
)]
public class User
{
    [Required]
    [StringLength(100)]
    public string Name { get; set; }
}

// Generates:
[Serializable]
[JsonObject]
public class UserDto
{
    [Required]
    [StringLength(100)]
    public string Name { get; set; }
}
```

#### Namespaces and Using Directives

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `Usings` | string[] | null | Additional using directives |
| `AddReferencedNamespacesUsings` | bool | false | Add usings for all referenced namespaces |
| `AddContainingNamespaceUsings` | bool | false | Add using for source class namespace |

**Example:**
```csharp
[AutoGenerateDto(
    Usings = new[] { "System.ComponentModel.DataAnnotations", "MyApp.Helpers" },
    AddReferencedNamespacesUsings = true
)]
public class User { }
```

### Complete Example

```csharp
using Nextended.Core.Attributes;
using Nextended.Core.Enums;

[AutoGenerateDto(
    // Naming
    Namespace = "MyApp.Api.Dtos",
    Suffix = "Response",
    
    // Mapping
    ToDtoMethodName = "ToApiResponse",
    ToSourceMethodName = "ToEntity",
    
    // Inheritance
    BaseType = "BaseResponse",
    Interfaces = new[] { "IApiResponse" },
    
    // Properties
    PropertiesToIgnore = new[] { "PasswordHash", "InternalData" },
    
    // Modifiers
    ClassModifier = Modifier.Public,
    
    // Attributes
    KeepPropertyAttributesOnGeneratedClass = true,
    PreClassString = "[Serializable]",
    
    // Namespaces
    Usings = new[] { "System.ComponentModel.DataAnnotations" }
)]
public class User
{
    public int Id { get; set; }
    
    [Required]
    [StringLength(100)]
    public string Username { get; set; }
    
    [EmailAddress]
    public string Email { get; set; }
    
    [IgnoreOnGeneration]
    public string PasswordHash { get; set; }
    
    public DateTime CreatedAt { get; set; }
}

// Usage:
var user = GetUser();
var response = user.ToApiResponse();
var userAgain = response.ToEntity();
```

## Configuration Options

### DtoGeneration Options (CodeGen.config.json)

These settings apply to all DTOs unless overridden by attribute properties.

| Option | Type | Description |
|--------|------|-------------|
| `Namespace` | string | Default namespace for generated DTOs |
| `Suffix` | string | Default suffix for DTO class names (default: "Dto") |
| `Prefix` | string | Default prefix for DTO class names |
| `ToDtoMethodName` | string | Default name of ToDto extension method |
| `ToSourceMethodName` | string | Default name of ToSource extension method |
| `IsComCompatible` | bool | Generate COM-compatible GUIDs by default |
| `GeneratePartial` | bool | Generate as partial classes (default: true) |
| `OneFilePerClass` | bool | Create separate file per DTO (default: true) |
| `CreateRegions` | bool | Add region blocks (default: true) |
| `CreateComments` | bool | Add XML comments (default: true) |
| `ComIdClassName` | string | Name of the class for COM GUIDs |
| `ComIdClassPropertyFormat` | string | Format for COM ID properties |
| `ComIdClassModifier` | string | Modifier for COM ID class |
| `BaseType` | string | Default base type for DTOs |
| `Interfaces` | string[] | Default interfaces for DTOs |
| `Usings` | string[] | Default using directives |
| `KeepAttributesOnGeneratedClass` | bool | Copy attributes from source classes |
| `KeepAttributesOnGeneratedInterface` | bool | Copy attributes to interfaces |
| `AddReferencedNamespacesUsings` | bool | Add usings for referenced namespaces |
| `AddContainingNamespaceUsings` | bool | Add using for source namespaces |
| `PreInterfaceString` | string | String before generated interfaces |
| `PreClassString` | string | String before generated classes |
| `DefaultMappingSettings` | object | Default mapping settings configuration |
| `OutputPath` | string | Output directory for generated files |

### StructureGeneration Options (JSON/XML)

Complete reference for generating classes from JSON and XML files.

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `SourceFile` | string | Yes | Path to JSON or XML source file (relative to project root) |
| `RootClassName` | string | Yes | Name of the root generated class |
| `Namespace` | string | Yes | Target namespace for generated classes |
| `Prefix` | string | No | Prefix for all generated class names |
| `Suffix` | string | No | Suffix for all generated class names |
| `Ignore` | string[] | No | Property paths to ignore (e.g., "Database.Password") |
| `OutputPath` | string | No | Output directory for generated files (if null, added to compilation) |

#### JSON Generation Examples

**Basic Configuration File:**

**appsettings.json:**
```json
{
  "Database": {
    "ConnectionString": "Server=localhost;Database=MyDb;",
    "MaxPoolSize": 100,
    "EnableLogging": true
  },
  "Api": {
    "BaseUrl": "https://api.example.com",
    "Timeout": 30,
    "ApiKey": "secret-key"
  }
}
```

**Configuration:**
```json
{
  "StructureGenerations": [
    {
      "SourceFile": "/Config/appsettings.json",
      "RootClassName": "AppSettings",
      "Namespace": "MyApp.Configuration"
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Configuration
{
    public class AppSettings
    {
        public Database Database { get; set; }
        public Api Api { get; set; }
    }

    public class Database
    {
        public string ConnectionString { get; set; }
        public int MaxPoolSize { get; set; }
        public bool EnableLogging { get; set; }
    }

    public class Api
    {
        public string BaseUrl { get; set; }
        public int Timeout { get; set; }
        public string ApiKey { get; set; }
    }
}
```

**Usage:**
```csharp
var config = new AppSettings
{
    Database = new Database
    {
        ConnectionString = "...",
        MaxPoolSize = 100
    }
};
```

**Advanced with Ignore:**

```json
{
  "StructureGenerations": [
    {
      "SourceFile": "/Config/appsettings.json",
      "RootClassName": "AppSettings",
      "Namespace": "MyApp.Configuration",
      "Prefix": "Cfg",
      "Ignore": ["Api.ApiKey", "Database.ConnectionString"],
      "OutputPath": "./Generated/Config/"
    }
  ]
}
```

**Complex JSON Structure:**

**users.json:**
```json
{
  "users": [
    {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "roles": ["admin", "user"],
      "metadata": {
        "lastLogin": "2024-01-15T10:30:00Z",
        "loginCount": 42
      }
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 10,
    "total": 100
  }
}
```

**Generated Classes:**
```csharp
public class UsersRoot
{
    public List<User> Users { get; set; }
    public Pagination Pagination { get; set; }
}

public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Email { get; set; }
    public List<string> Roles { get; set; }
    public Metadata Metadata { get; set; }
}

public class Metadata
{
    public DateTime LastLogin { get; set; }
    public int LoginCount { get; set; }
}

public class Pagination
{
    public int Page { get; set; }
    public int PageSize { get; set; }
    public int Total { get; set; }
}
```

#### XML Generation Examples

**Simple XML Configuration:**

```xml
<!-- config.xml -->
<Configuration>
  <Server>
    <Host>localhost</Host>
    <Port>8080</Port>
    <UseSSL>true</UseSSL>
  </Server>
  <Logging>
    <Level>Information</Level>
    <FilePath>logs/app.log</FilePath>
  </Logging>
</Configuration>
```

**Configuration:**
```json
{
  "StructureGenerations": [
    {
      "SourceFile": "/Config/config.xml",
      "RootClassName": "Configuration",
      "Namespace": "MyApp.Config"
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Config
{
    public class Configuration
    {
        public Server Server { get; set; }
        public Logging Logging { get; set; }
    }

    public class Server
    {
        public string Host { get; set; }
        public int Port { get; set; }
        public bool UseSSL { get; set; }
    }

    public class Logging
    {
        public string Level { get; set; }
        public string FilePath { get; set; }
    }
}
```

### ExcelGeneration Options

Complete reference for generating classes from Excel spreadsheets.

| Option | Type | Required | Description |
|--------|------|----------|-------------|
| `SourceFile` | string | Yes | Path to Excel file (.xlsx, .xls) |
| `SheetName` | string | No | Specific sheet name (null for first sheet) |
| `Namespace` | string | Yes | Target namespace for generated classes |
| `RootClassName` | string | Yes | Name of the model/record class |
| `StaticClassName` | string | No | Name of the static lookup class |
| `KeyColumn` | string | No | Column letter to use as key (e.g., "A", "B") |
| `HeaderRowIndex` | int | Yes | Row number containing column headers (1-based) |
| `DataStartRowIndex` | int | Yes | First row number containing data (1-based) |
| `ModelType` | string | No | Type of model: "Class", "RecordClass", "RecordStruct" (default: "Class") |
| `GenerateModelClass` | bool | No | Generate the model/record class (default: true) |
| `GenerateStaticTable` | bool | No | Generate static lookup class with data (default: false) |
| `GenerateAllCollection` | bool | No | Generate collection of all records (default: false) |
| `ColumnMappings` | Dictionary<string,string> | No | Map Excel column names to property names |
| `PropertyTypeOverrides` | Dictionary<string,string> | No | Override property types |
| `OutputPath` | string | No | Output directory for generated files |

#### Excel Generation Examples

**Example 1: Simple Data Table**

**Excel File (countries.xlsx):**
```
| Code | Name           | Population | Capital    |
|------|----------------|------------|------------|
| US   | United States  | 331000000  | Washington |
| UK   | United Kingdom | 67000000   | London     |
| FR   | France         | 65000000   | Paris      |
```

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Data/countries.xlsx",
      "Namespace": "MyApp.Data",
      "RootClassName": "Country",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "GenerateModelClass": true
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Data
{
    public class Country
    {
        public string Code { get; set; }
        public string Name { get; set; }
        public int Population { get; set; }
        public string Capital { get; set; }
    }
}
```

**Example 2: Static Lookup Table**

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Data/countries.xlsx",
      "Namespace": "MyApp.Data",
      "RootClassName": "Country",
      "StaticClassName": "Countries",
      "KeyColumn": "A",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "GenerateModelClass": true,
      "GenerateStaticTable": true,
      "GenerateAllCollection": true
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Data
{
    public class Country
    {
        public string Code { get; set; }
        public string Name { get; set; }
        public int Population { get; set; }
        public string Capital { get; set; }
    }

    public static class Countries
    {
        public static Country US { get; } = new Country
        {
            Code = "US",
            Name = "United States",
            Population = 331000000,
            Capital = "Washington"
        };

        public static Country UK { get; } = new Country
        {
            Code = "UK",
            Name = "United Kingdom",
            Population = 67000000,
            Capital = "London"
        };

        public static Country FR { get; } = new Country
        {
            Code = "FR",
            Name = "France",
            Population = 65000000,
            Capital = "Paris"
        };

        public static IReadOnlyList<Country> All { get; } = new[]
        {
            US, UK, FR
        };
    }
}
```

**Usage:**
```csharp
// Access by key
var us = Countries.US;
Console.WriteLine($"{us.Name}: {us.Population}");

// Access all
foreach (var country in Countries.All)
{
    Console.WriteLine(country.Name);
}

// Find by code
var france = Countries.All.FirstOrDefault(c => c.Code == "FR");
```

**Example 3: Record Struct with Column Mapping**

**Excel File (products.xlsx):**
```
| Product ID | Product Name    | Unit Price | In Stock |
|------------|-----------------|------------|----------|
| P001       | Widget A        | 19.99      | Yes      |
| P002       | Gadget B        | 29.99      | No       |
```

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Data/products.xlsx",
      "Namespace": "MyApp.Catalog",
      "RootClassName": "Product",
      "ModelType": "RecordStruct",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "ColumnMappings": {
        "Product ID": "ProductId",
        "Product Name": "Name",
        "Unit Price": "Price",
        "In Stock": "Available"
      }
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Catalog
{
    public record struct Product
    {
        public string ProductId { get; init; }
        public string Name { get; init; }
        public double Price { get; init; }
        public string Available { get; init; }
    }
}
```

**Example 4: Custom Property Types**

**Excel File (locations.xlsx):**
```
| Code | Name        | Coordinates      | Status  | Type      |
|------|-------------|------------------|---------|-----------|
| NYC  | New York    | 40.7128,-74.0060 | Active  | Primary   |
| LAX  | Los Angeles | 34.0522,-118.2437| Active  | Secondary |
```

**Custom Types:**
```csharp
namespace MyApp.Types
{
    public record struct Coordinates
    {
        public double Latitude { get; init; }
        public double Longitude { get; init; }

        public static Coordinates Parse(string value)
        {
            var parts = value.Split(',');
            return new Coordinates
            {
                Latitude = double.Parse(parts[0]),
                Longitude = double.Parse(parts[1])
            };
        }
    }

    public enum LocationStatus { Active, Inactive }
    public enum LocationType { Primary, Secondary, Tertiary }
}
```

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Data/locations.xlsx",
      "Namespace": "MyApp.Data",
      "RootClassName": "Location",
      "StaticClassName": "Locations",
      "KeyColumn": "A",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "ModelType": "RecordStruct",
      "GenerateStaticTable": true,
      "PropertyTypeOverrides": {
        "Coordinates": "MyApp.Types.Coordinates",
        "Status": "MyApp.Types.LocationStatus",
        "Type": "MyApp.Types.LocationType"
      },
      "ColumnMappings": {
        "Status": "Status",
        "Type": "Type"
      }
    }
  ]
}
```

**Generated Code:**
```csharp
namespace MyApp.Data
{
    public record struct Location
    {
        public string Code { get; init; }
        public string Name { get; init; }
        public MyApp.Types.Coordinates Coordinates { get; init; }
        public MyApp.Types.LocationStatus Status { get; init; }
        public MyApp.Types.LocationType Type { get; init; }
    }

    public static class Locations
    {
        public static Location NYC { get; } = new Location
        {
            Code = "NYC",
            Name = "New York",
            Coordinates = MyApp.Types.Coordinates.Parse("40.7128,-74.0060"),
            Status = MyApp.Types.LocationStatus.Active,
            Type = MyApp.Types.LocationType.Primary
        };

        public static Location LAX { get; } = new Location
        {
            Code = "LAX",
            Name = "Los Angeles",
            Coordinates = MyApp.Types.Coordinates.Parse("34.0522,-118.2437"),
            Status = MyApp.Types.LocationStatus.Active,
            Type = MyApp.Types.LocationType.Secondary
        };
    }
}
```

**Example 5: Multiple Sheets**

```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Data/masterdata.xlsx",
      "SheetName": "Customers",
      "Namespace": "MyApp.Data",
      "RootClassName": "Customer",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2
    },
    {
      "SourceFile": "/Data/masterdata.xlsx",
      "SheetName": "Products",
      "Namespace": "MyApp.Data",
      "RootClassName": "Product",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2
    }
  ]
}
```

**Example 6: Complete Real-World Scenario**

**Excel File (scac_codes.xlsx) - Shipping Carrier Codes:**
```
| SCAC | Carrier Name          | Country | Contact Email      | Active |
|------|-----------------------|---------|--------------------|--------|
| ABCD | ABC Logistics         | USA     | info@abclog.com    | Yes    |
| EFGH | EFG Shipping Co       | USA     | contact@efg.com    | Yes    |
| WXYZ | WXY International     | CAN     | support@wxy.com    | No     |
```

**Configuration:**
```json
{
  "ExcelGenerations": [
    {
      "SourceFile": "/Sources/scac_codes.xlsx",
      "SheetName": null,
      "Namespace": "Shipping.Data",
      "RootClassName": "ScacCode",
      "StaticClassName": "ScacCodes",
      "KeyColumn": "A",
      "HeaderRowIndex": 1,
      "DataStartRowIndex": 2,
      "ModelType": "RecordStruct",
      "GenerateModelClass": true,
      "GenerateStaticTable": true,
      "GenerateAllCollection": true,
      "ColumnMappings": {
        "SCAC": "Code",
        "Carrier Name": "CarrierName",
        "Contact Email": "Email"
      },
      "PropertyTypeOverrides": {
        "Active": "bool"
      },
      "OutputPath": "./Generated/Shipping/"
    }
  ]
}
```

**Generated Usage:**
```csharp
using Shipping.Data;

// Lookup by key
var carrier = ScacCodes.ABCD;
Console.WriteLine($"Carrier: {carrier.CarrierName}");

// Search all
var activeCarriers = ScacCodes.All
    .Where(c => c.Active)
    .ToList();

// Use in dropdown
var dropdownItems = ScacCodes.All
    .Select(c => new { Value = c.Code, Label = c.CarrierName })
    .ToList();
```

#### Best Practices for Excel Generation

1. **Clean Headers**: Use clear, descriptive column headers without special characters
2. **Consistent Data Types**: Ensure columns contain consistent data types
3. **Key Columns**: Use columns with unique values for `KeyColumn`
4. **Type Overrides**: Use `PropertyTypeOverrides` for enums, custom types, or specific numeric types
5. **Column Mapping**: Use `ColumnMappings` to create clean property names from complex headers
6. **Model Types**:
   - Use `RecordStruct` for small, immutable data
   - Use `RecordClass` for immutable reference types
   - Use `Class` for mutable data that needs modification
7. **Output Path**: Use `OutputPath` to organize generated files separately from source code

## Best Practices

### 1. Use Meaningful Names

```csharp
[AutoGenerateDto(
    Namespace = "MyApp.Api.Dtos",
    ToDtoMethodName = "ToApiDto",
    ToSourceMethodName = "ToEntity"
)]
public class User { }
```

### 2. Organize Generated Code

```json
{
  "DtoGeneration": {
    "Namespace": "MyApp.Generated.Dtos",
    "OutputPath": "./Generated/Dtos/",
    "OneFilePerClass": true
  }
}
```

### 3. Version Control Generated Files

Add to `.gitignore` if you regenerate on build, or commit them if you want to review changes.

### 4. Use Partial Classes for Customization

Generated as partial classes allow you to extend:

```csharp
// Generated
public partial class UserDto
{
    public int Id { get; set; }
    public string Name { get; set; }
}

// Your custom code
public partial class UserDto
{
    public string DisplayName => $"User: {Name}";
}
```

## Attribute Reference

### AutoGenerateDtoAttribute

The `AutoGenerateDtoAttribute` is the primary attribute for generating DTOs from your classes. It provides extensive configuration options to control the generated code.

#### Properties

##### Namespace Configuration

```csharp
[AutoGenerateDto(Namespace = "MyApp.Dtos")]
public class User { }
```

**Namespace** (`string?`)  
Sets the namespace for the generated DTO. If not specified, uses the configuration file default or the source class namespace with a "Dto" suffix.

##### Naming Configuration

```csharp
[AutoGenerateDto(
    Prefix = "Api",
    Suffix = "Response",
    GeneratedClassName = "CustomUserName"  // Overrides prefix/suffix
)]
public class User { }
// Generates: ApiUserResponse or CustomUserName
```

**Prefix** (`string?`)  
Adds a prefix to the generated class name. Default: empty string.

**Suffix** (`string?`)  
Adds a suffix to the generated class name. Default: "Dto".

**GeneratedClassName** (`string?`)  
Explicitly sets the generated class name, overriding prefix and suffix logic.

##### Property Filtering

```csharp
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    
    [IgnoreOnGeneration]
    public string Password { get; set; }  // Excluded from DTO
}

// Alternative: Configure in attribute
[AutoGenerateDto(PropertiesToIgnore = new[] { "Password", "InternalId" })]
public class User 
{
    public string Password { get; set; }
    public string InternalId { get; set; }
}
```

**PropertiesToIgnore** (`string[]`)  
Array of property names to exclude from the generated DTO.

##### Mapping Configuration

```csharp
[AutoGenerateDto(
    GenerateMapping = true,
    ToDtoMethodName = "ToUserDto",
    ToSourceMethodName = "ToUser"
)]
public class User { }

// Usage
var user = GetUser();
var dto = user.ToUserDto();
var userAgain = dto.ToUser();
```

**GenerateMapping** (`bool`)  
When true, generates extension methods for mapping between source and DTO. Default: true.

**ToDtoMethodName** (`string?`)  
Name of the method that converts source to DTO. Default: "ToDto".

**ToSourceMethodName** (`string?`)  
Name of the method that converts DTO back to source. Default: "ToSource".

##### COM Compatibility

```csharp
[AutoGenerateDto(IsComCompatible = true)]
public class User { }
```

**IsComCompatible** (`bool`)  
Generates COM-visible classes with appropriate attributes and GUIDs. Used for COM interop scenarios.

##### Type Configuration

```csharp
[AutoGenerateDto(
    BaseType = "EntityBase",
    Interfaces = new[] { "IEntity", "IAuditable" }
)]
public class User { }

// Generates:
public class UserDto : EntityBase, IEntity, IAuditable { }
```

**BaseType** (`string?`)  
Sets the base class for the generated DTO.

**Interfaces** (`string[]?`)  
Adds interfaces that the generated DTO should implement.

##### Modifiers

```csharp
[AutoGenerateDto(
    ClassModifier = Modifier.Internal,
    InterfaceModifier = Modifier.Public
)]
public class User { }
```

**ClassModifier** (`Modifier`)  
Access modifier for the generated class. Options: `Unset`, `Public`, `Private`, `Protected`, `Internal`.

**InterfaceModifier** (`Modifier`)  
Access modifier for the generated interface (if applicable).

**DefaultPropertyInterfaceAccess** (`InterfaceProperty`)  
Default accessor type for interface properties. Options: `Unset`, `GetAndSet`, `Get`, `Set`.

##### Using Directives

```csharp
[AutoGenerateDto(
    Usings = new[] { "System.Text.Json.Serialization", "MyApp.CustomTypes" },
    AddReferencedNamespacesUsings = true,
    AddContainingNamespaceUsings = true
)]
public class User { }
```

**Usings** (`string[]?`)  
Additional using directives to include in the generated file.

**AddReferencedNamespacesUsings** (`bool`)  
Automatically includes using directives for all referenced types.

**AddContainingNamespaceUsings** (`bool`)  
Includes using directive for the source class's namespace.

##### Custom Code Injection

```csharp
[AutoGenerateDto(
    PreInterfaceString = "[JsonObject]",
    PreClassString = "[Serializable]\n[DataContract]"
)]
public class User { }

// Generates:
[JsonObject]
public interface IUserDto { }

[Serializable]
[DataContract]
public class UserDto { }
```

**PreInterfaceString** (`string?`)  
Code to insert before the generated interface declaration (e.g., attributes).

**PreClassString** (`string?`)  
Code to insert before the generated class declaration (e.g., attributes).

##### Attribute Preservation

```csharp
[AutoGenerateDto(
    KeepAttributesOnGeneratedClass = true,
    KeepAttributesOnGeneratedInterface = true,
    KeepPropertyAttributesOnGeneratedClass = true,
    KeepPropertyAttributesOnGeneratedInterface = true
)]
[DataContract]
public class User 
{
    [Required]
    [DataMember]
    public string Name { get; set; }
}

// Generated DTO keeps the attributes
[DataContract]
public class UserDto 
{
    [Required]
    [DataMember]
    public string Name { get; set; }
}
```

**KeepAttributesOnGeneratedClass** (`bool`)  
Copies class-level attributes from source to generated class.

**KeepAttributesOnGeneratedInterface** (`bool`)  
Copies class-level attributes from source to generated interface.

**KeepPropertyAttributesOnGeneratedClass** (`bool`)  
Copies property-level attributes from source properties to generated class properties.

**KeepPropertyAttributesOnGeneratedInterface** (`bool`)  
Copies property-level attributes from source properties to generated interface properties.

##### Derived Type Generation

```csharp
[AutoGenerateDto(AutoGenerateDerived = true)]
public class BaseEntity { }

public class User : BaseEntity { }  // DTO automatically generated
public class Product : BaseEntity { }  // DTO automatically generated
```

**AutoGenerateDerived** (`bool`)  
Automatically generates DTOs for all derived types when applied to a base class.

### IgnoreOnGenerationAttribute

Use this attribute to exclude specific properties or fields from DTO generation.

```csharp
public class User
{
    public int Id { get; set; }
    public string Name { get; set; }
    
    [IgnoreOnGeneration]
    public string Password { get; set; }
    
    [IgnoreOnGeneration]
    public byte[] PasswordHash { get; set; }
}
```

### GenerationPropertySettingAttribute

Fine-tune individual property generation with this attribute.

```csharp
public class User
{
    public int Id { get; set; }
    
    [GenerationPropertySetting(
        PropertyName = "FullName",  // Rename in DTO
        MapWithClassMapper = true,   // Use ClassMapper for conversion
        InterfaceAccess = InterfaceProperty.Get,  // Read-only in interface
        PreClassString = "[JsonProperty(\"full_name\")]",
        KeepAttributesOnGeneratedClass = true
    )]
    public string Name { get; set; }
}

// Generated:
public interface IUserDto
{
    string FullName { get; }  // Read-only
}

public class UserDto : IUserDto
{
    [JsonProperty("full_name")]
    public string FullName { get; set; }
}
```

**Properties:**

- **PropertyName** (`string?`) - Custom name for the property in the generated DTO
- **MapWithClassMapper** (`bool`) - Use ClassMapper for type conversion during mapping
- **InterfaceAccess** (`InterfaceProperty`) - Property accessor type in interfaces (Get, Set, or GetAndSet)
- **PreInterfaceString** (`string?`) - Code to insert before the property in the interface
- **PreClassString** (`string?`) - Code to insert before the property in the class
- **KeepAttributesOnGeneratedClass** (`bool`) - Keep property attributes in generated class
- **KeepAttributesOnGeneratedInterface** (`bool`) - Keep property attributes in generated interface

## Complete Example: Advanced DTO Generation

```csharp
using Nextended.Core.Attributes;
using Nextended.Core.Enums;

namespace MyApp.Domain
{
    /// <summary>
    /// User entity with complete DTO generation configuration
    /// </summary>
    [AutoGenerateDto(
        Namespace = "MyApp.Dtos",
        Suffix = "Response",
        ToDtoMethodName = "ToUserResponse",
        ToSourceMethodName = "ToUserEntity",
        GenerateMapping = true,
        BaseType = "AuditableDto",
        Interfaces = new[] { "IUserResponse", "IIdentifiable" },
        Usings = new[] { "System.Text.Json.Serialization" },
        ClassModifier = Modifier.Public,
        PreClassString = "[JsonSerializable(typeof(UserResponse))]",
        KeepPropertyAttributesOnGeneratedClass = true,
        PropertiesToIgnore = new[] { "PasswordHash", "PasswordSalt" }
    )]
    public class User
    {
        public int Id { get; set; }
        
        [Required]
        [MaxLength(100)]
        public string UserName { get; set; }
        
        [Required]
        [EmailAddress]
        public string Email { get; set; }
        
        [GenerationPropertySetting(
            PropertyName = "FullName",
            PreClassString = "[JsonPropertyName(\"fullName\")]"
        )]
        public string Name { get; set; }
        
        [IgnoreOnGeneration]
        public byte[] PasswordHash { get; set; }
        
        [IgnoreOnGeneration]
        public byte[] PasswordSalt { get; set; }
        
        public DateTime CreatedAt { get; set; }
        public DateTime? ModifiedAt { get; set; }
        
        public List<Address> Addresses { get; set; }
    }
    
    [AutoGenerateDto(
        Namespace = "MyApp.Dtos",
        Suffix = "Response"
    )]
    public class Address
    {
        public string Street { get; set; }
        public string City { get; set; }
        public string PostalCode { get; set; }
        public string Country { get; set; }
    }
}
```

Generated result:

```csharp
namespace MyApp.Dtos
{
    using System;
    using System.Collections.Generic;
    using System.Text.Json.Serialization;
    using System.ComponentModel.DataAnnotations;
    
    [JsonSerializable(typeof(UserResponse))]
    public class UserResponse : AuditableDto, IUserResponse, IIdentifiable
    {
        [Required]
        [MaxLength(100)]
        public string UserName { get; set; }
        
        [Required]
        [EmailAddress]
        public string Email { get; set; }
        
        [JsonPropertyName("fullName")]
        public string FullName { get; set; }
        
        public DateTime CreatedAt { get; set; }
        public DateTime? ModifiedAt { get; set; }
        
        public List<AddressResponse> Addresses { get; set; }
    }
    
    public class AddressResponse
    {
        public string Street { get; set; }
        public string City { get; set; }
        public string PostalCode { get; set; }
        public string Country { get; set; }
    }
}
```

Usage:

```csharp
var user = await _userRepository.GetByIdAsync(userId);
var response = user.ToUserResponse();
return Ok(response);
```

## Troubleshooting

### Generated Code Not Appearing

1. Ensure `CodeGen.config.json` is marked as `AdditionalFiles`
2. Clean and rebuild: `dotnet clean && dotnet build`
3. Check build output for generator messages
4. Verify source generators are enabled in IDE

### Build Errors After Generation

1. Check namespace conflicts
2. Verify property types are valid
3. Ensure all dependencies are installed

## Supported Frameworks

- .NET Standard 2.0 (Generator)
- .NET 8.0+  (Generated code)

## Dependencies

- Roslyn APIs for source generation
- `Nextended.Core` for attributes

## Related Projects

- [Nextended.Core](core.md) - Provides attributes and base functionality
- [Nextended.AutoDto](autodto.md) - DTO generation support

## Sample Project

See the [CodeGenSample](https://github.com/fgilde/Nextended/tree/main/CodeGenSample) project for complete examples.

## Links

- [NuGet Package](https://www.nuget.org/packages/Nextended.CodeGen/)
- [Source Code](https://github.com/fgilde/Nextended/tree/main/Nextended.CodeGen)
- [Official README](https://github.com/fgilde/Nextended/blob/main/Nextended.CodeGen/README.md)
- [Report Issues](https://github.com/fgilde/Nextended/issues)
